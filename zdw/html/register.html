<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../css/register.css">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../font_w4pnv670vg/iconfont.css">
    <script src="../js/public.js"></script>
</head>
<body>
    <div class="regist_top">
        <a href="#">
            <img src="../img/images/logo.jpg" alt="">
        </a>
    </div>
    <div class="regist_down">
        <h1>
            <img src="../img/images/login_banner.jpg" alt="">
        </h1>
        <script>
            
        </script>
        <form action="#" method="get">
            <div class="sideR">
                <a href="#" class="t1" index=0>账号登录</a>
                <a href="#" class="t1" index=1>手机登录</a>
                <a href="#" class="t1" index=2>卡登录</a>
                <!---------------------------------------->
                <div class="user">用户名:</div>
                <div class="user1">
                    <input id="yhm" type="text" name="asdf" autocomplete autofocus onfocus=autoFocus(input[0]) onblur=autoBlurs(input[0])> 
                    <p>请输入账户或邮箱地址</p>
                </div>
                <!--------------------------------------------->
                <div class="password">登录密码:</div>
                <div class="pw">
                        <input id="mm" type="text" name="sadfasd"  onfocus=autoFocus(input[1]) onblur=autoBlurs(input[1])>
                        <p>请输入密码</p>
                </div>
                <!--------------------------------------------->          
                <div class="verify">验证码:</div>
                <div class="verifyNum">
                    <input id="yzm" type="text" onfocus=autoFocus(input[2]) onblur=autoBlurs(input[2])>
                    <div class="vf">
                        123456
                    </div>
                    <a onclick=fn()>换一张</a>
                    <p>请输入验证码</p>
                </div>
                <div class="ckbox">
                    <input type="checkbox"  class="ck1" checked> 记住用户名
                    <input type="checkbox"  class="ck1"> 自动登录
                </div>
                
                <input type="submit" id="sbmt" value="登录" ><a href="#" id="zh">找回密码</a>
                <div class="bottom">
                    <span style="line-height:41px">还不是邦购网用户？马上加入吧...</span>
                    <a href="#" >免费注册>></a>
                </div>
                <div class="down">
                    <h1>或者使用合作网站登录</h1><p></p>
                    <a href="#" class="qq iconfont icon-qq" style="text-indent:30px"><span style="margin-left:10px">QQ</span></a>
                    <a href="#" class="zfb iconfont icon-qq" style="text-indent:18px"><span style="margin-left:10px">支付宝</span></a>
                    <a href="#" class="wx iconfont icon-qq" style="text-indent:22px"><span style="margin-left:10px">微信</span></a>
                </div>
            </div>
        </form>
    </div>
    <script>
        var t1 = document.getElementsByClassName("t1");/*绑定账号登录、卡登入、手机登录的3个a标签*/
        var vf= document.getElementsByClassName("vf");/*存放验证码的盒子*/
        var input = document.getElementsByTagName("input");/*所有input的标签*/
        var user = document.getElementsByClassName("user");/*存放文本内容为“用户名”的盒子*/
        var user1 = document.getElementsByClassName("user1");/*存放“输入用户名及提示框的盒子”*/
        var yhm = document.getElementById("yhm");/*绑定输入用户名的input标签*/
        var mm = document.getElementById("mm");/*绑定输入密码的input标签*/
        var yzm = document.getElementById("yzm");/*绑定输入验证码的input标签*/
        var password = document.getElementsByClassName("password");/*存放文本内容为“密码”的盒子*/
        var sbmt = document.getElementById("sbmt");/*提交按钮*/
        var ck1 = document.getElementsByClassName("ck1");/*多选框*/
        var ckbox = document.getElementsByClassName("ckbox");/*多选框外的大盒子*/
        t1[1].style.borderRight = "1px solid #ccc";
        t1[1].style.borderLeft = "1px solid #ccc"; 
        function autoFocus(item){
                var items = item.parentNode.children;
                items[items.length-1].style.display = "block";
            }
            function autoBlurs(item){
                var items = item.parentNode.children;
               items[items.length-1].style.display = "none";
            }
        function fn1(obj){/*给某个obj添加某样式，其他的删除某样式*/
            for(var j=0,leng=t1.length;j<leng;j++){
                t1[j].style.borderBottom = "1px solid #ccc";
                t1[j].style.borderTop = "none";
                t1[j].style.height = "39px";
            };
            obj.style.borderBottom = "none";
            obj.style.borderTop = "2px solid red";
            obj.style.height ="38px";
        } 
        fn1(t1[0]);/*t1【0】添加某样式，其它的，如t1[1]、t1[2]删除某样式*/
        if(location.search.split("=")[1] == 222222){
            fn6781(t1[1]);
        }else if(location.search.split("=")[1] == 333333){
            fn6781(t1[2]);
        };
        function fn6781(item){/*账号、手机号、卡号切换登陆时的点击事件*/
                fn1(item);
                var index = item.getAttribute("index");  
                var xhr = window.XMLHttpRequest ? new XMLHttpRequest : 
                new ActiveXObject('Microsoft.XMLHTTp');
                xhr.onreadystatechange = function(){
                    if(xhr.readyState == 4 && xhr.status == 200){
                        var response = JSON.parse(xhr.responseText);
                        user[0].innerText = response.one;
                        password[0].innerText = response.two;
                        user1[0].children[1].innerText = response.p;
                    }
                }
                xhr.open("get","../php/data.php?a="+index,true);
                xhr.send(null);
                user1[0].children[0].focus();
            }
        for(var i=0,len=t1.length;i<len;i++){
             t1[i].onclick = function(){
                 fn6781(this);
             };   
        }
        function fn(){/*给验证码盒子的文本内容添加随机验证码*/
            vf[0].innerText = captcha(4);
        }
        fn();
        sbmt.onclick = function(){/*提交按钮的点击事件*/    
            var userVal = yhm.value;
            var pwVal = mm.value;
            var yzmVal = yzm.value;
            var xhr = window.XMLHttpRequest ? new XMLHttpRequest :
            new ActiveXObject('Microsoft.XMLHTTP');
            xhr.onreadystatechange = function(){
                if(xhr.readyState == 4 && xhr.status == 200){
                    var response = JSON.parse(xhr.responseText);
                    if(response.code == -1){
                        return alert("该用户名不存在，请重新输入！");
                    }else if(response.password != pwVal){
                        return alert("密码错误，请重新输入密码"); 
                    }else if(yzmVal != vf[0].innerText){
                        return alert("验证码错误，请重新输入!");
                    }else{
                        var date2 = new Date();
                        date2.setDate(date2.getDate() +14);
                        if(ck1[0].checked == true){/*判断是否选择记住用户名*/      
                            document.cookie = "username" + "=" +  response.username +";expires =" + date2;
                        };
                        if(ck1[1].checked == true){
                            document.cookie = "password" + "=" + response.password + ";expires =" + date2; 
                            document.cookie = "flag" + "=" + "1" + ";expires =" + date2;
                        }else{
                            document.cookie = clearCookie("password");
                            document.cookie = "flag" + "=" + "" + ";expires =" + date2;
                        };
                        inputYHM();        
                        return location.href = "./title.html";
                    };
                };
            };    
            xhr.open("get","../php/data2.php?user="+userVal+"&pw="+pwVal,true);
            xhr.send(null); 
            return false;     
        };
        function inputYHM(){/*把用户名添加到对应的input框中*/
            if(getCookieValue("username")){/*存在则把用户名放进去*/            
                    var sss = getCookieValue("username");
                    yhm.value = sss;              
                    if(ck1[0].checked == false){/*若没有勾选，则把对应的cookie值清空，使下一次登录yhm.value为空*/
                        clearCookie("username");
                    };        
            };
        };   
        inputYHM(); 
        function clearCookie(item){/*清除对应name的值*/
            var date = new Date();         
            document.cookie = item + "=" +"" + ";expires = " + date.setDate(date.getDate() -9999);                        
        };
    </script>
</body>
</html>